PREHOOK: query: -- HIVE-2340 deduplicate RS followed by RS
-- hive.optimize.reducededuplication : wherther using this optimization
-- hive.optimize.reducededuplication.min.reducer : number of reducer of deduped RS should be this at least

create table src9 (key string, value string)
PREHOOK: type: CREATETABLE
POSTHOOK: query: -- HIVE-2340 deduplicate RS followed by RS
-- hive.optimize.reducededuplication : wherther using this optimization
-- hive.optimize.reducededuplication.min.reducer : number of reducer of deduped RS should be this at least

create table src9 (key string, value string)
POSTHOOK: type: CREATETABLE
POSTHOOK: Output: default@src9
PREHOOK: query: load data local inpath '../data/files/kv9.txt' into table src9
PREHOOK: type: LOAD
PREHOOK: Output: default@src9
POSTHOOK: query: load data local inpath '../data/files/kv9.txt' into table src9
POSTHOOK: type: LOAD
POSTHOOK: Output: default@src9
PREHOOK: query: -- RS-mGBY-RS-rGBY
explain select key, value from (select key, value from src9 order by key, value) t group by value, key
PREHOOK: type: QUERY
POSTHOOK: query: -- RS-mGBY-RS-rGBY
explain select key, value from (select key, value from src9 order by key, value) t group by value, key
POSTHOOK: type: QUERY
ABSTRACT SYNTAX TREE:
  (TOK_QUERY (TOK_FROM (TOK_SUBQUERY (TOK_QUERY (TOK_FROM (TOK_TABREF (TOK_TABNAME src9))) (TOK_INSERT (TOK_DESTINATION (TOK_DIR TOK_TMP_FILE)) (TOK_SELECT (TOK_SELEXPR (TOK_TABLE_OR_COL key)) (TOK_SELEXPR (TOK_TABLE_OR_COL value))) (TOK_ORDERBY (TOK_TABSORTCOLNAMEASC (TOK_TABLE_OR_COL key)) (TOK_TABSORTCOLNAMEASC (TOK_TABLE_OR_COL value))))) t)) (TOK_INSERT (TOK_DESTINATION (TOK_DIR TOK_TMP_FILE)) (TOK_SELECT (TOK_SELEXPR (TOK_TABLE_OR_COL key)) (TOK_SELEXPR (TOK_TABLE_OR_COL value))) (TOK_GROUPBY (TOK_TABLE_OR_COL value) (TOK_TABLE_OR_COL key))))

STAGE DEPENDENCIES:
  Stage-1 is a root stage
  Stage-0 is a root stage

STAGE PLANS:
  Stage: Stage-1
    Map Reduce
      Alias -> Map Operator Tree:
        t:src9 
          TableScan
            alias: src9
            Select Operator
              expressions:
                    expr: key
                    type: string
                    expr: value
                    type: string
              outputColumnNames: _col0, _col1
              Reduce Output Operator
                key expressions:
                      expr: _col1
                      type: string
                      expr: _col0
                      type: string
                sort order: ++
                tag: -1
                value expressions:
                      expr: _col0
                      type: string
                      expr: _col1
                      type: string
      Reduce Operator Tree:
        Extract
          Select Operator
            expressions:
                  expr: _col0
                  type: string
                  expr: _col1
                  type: string
            outputColumnNames: _col0, _col1
            Group By Operator
              bucketGroup: false
              keys:
                    expr: _col1
                    type: string
                    expr: _col0
                    type: string
              mode: complete
              outputColumnNames: _col0, _col1
              Select Operator
                expressions:
                      expr: _col1
                      type: string
                      expr: _col0
                      type: string
                outputColumnNames: _col0, _col1
                File Output Operator
                  compressed: false
                  GlobalTableId: 0
                  table:
                      input format: org.apache.hadoop.mapred.TextInputFormat
                      output format: org.apache.hadoop.hive.ql.io.HiveIgnoreKeyTextOutputFormat
                      serde: org.apache.hadoop.hive.serde2.lazy.LazySimpleSerDe

  Stage: Stage-0
    Fetch Operator
      limit: -1


PREHOOK: query: -- mGBY-RS-rGBY-RS
-- should not be optimized
explain select key, sum(key) as value from src9 group by key order by value, key
PREHOOK: type: QUERY
POSTHOOK: query: -- mGBY-RS-rGBY-RS
-- should not be optimized
explain select key, sum(key) as value from src9 group by key order by value, key
POSTHOOK: type: QUERY
ABSTRACT SYNTAX TREE:
  (TOK_QUERY (TOK_FROM (TOK_TABREF (TOK_TABNAME src9))) (TOK_INSERT (TOK_DESTINATION (TOK_DIR TOK_TMP_FILE)) (TOK_SELECT (TOK_SELEXPR (TOK_TABLE_OR_COL key)) (TOK_SELEXPR (TOK_FUNCTION sum (TOK_TABLE_OR_COL key)) value)) (TOK_GROUPBY (TOK_TABLE_OR_COL key)) (TOK_ORDERBY (TOK_TABSORTCOLNAMEASC (TOK_TABLE_OR_COL value)) (TOK_TABSORTCOLNAMEASC (TOK_TABLE_OR_COL key)))))

STAGE DEPENDENCIES:
  Stage-1 is a root stage
  Stage-2 depends on stages: Stage-1
  Stage-0 is a root stage

STAGE PLANS:
  Stage: Stage-1
    Map Reduce
      Alias -> Map Operator Tree:
        src9 
          TableScan
            alias: src9
            Select Operator
              expressions:
                    expr: key
                    type: string
              outputColumnNames: key
              Group By Operator
                aggregations:
                      expr: sum(key)
                bucketGroup: false
                keys:
                      expr: key
                      type: string
                mode: hash
                outputColumnNames: _col0, _col1
                Reduce Output Operator
                  key expressions:
                        expr: _col0
                        type: string
                  sort order: +
                  Map-reduce partition columns:
                        expr: _col0
                        type: string
                  tag: -1
                  value expressions:
                        expr: _col1
                        type: double
      Reduce Operator Tree:
        Group By Operator
          aggregations:
                expr: sum(VALUE._col0)
          bucketGroup: false
          keys:
                expr: KEY._col0
                type: string
          mode: mergepartial
          outputColumnNames: _col0, _col1
          Select Operator
            expressions:
                  expr: _col0
                  type: string
                  expr: _col1
                  type: double
            outputColumnNames: _col0, _col1
            File Output Operator
              compressed: false
              GlobalTableId: 0
              table:
                  input format: org.apache.hadoop.mapred.SequenceFileInputFormat
                  output format: org.apache.hadoop.hive.ql.io.HiveSequenceFileOutputFormat
                  serde: org.apache.hadoop.hive.serde2.lazybinary.LazyBinarySerDe

  Stage: Stage-2
    Map Reduce
      Alias -> Map Operator Tree:
#### A masked pattern was here ####
          TableScan
            Reduce Output Operator
              key expressions:
                    expr: _col1
                    type: double
                    expr: _col0
                    type: string
              sort order: ++
              tag: -1
              value expressions:
                    expr: _col0
                    type: string
                    expr: _col1
                    type: double
      Reduce Operator Tree:
        Extract
          File Output Operator
            compressed: false
            GlobalTableId: 0
            table:
                input format: org.apache.hadoop.mapred.TextInputFormat
                output format: org.apache.hadoop.hive.ql.io.HiveIgnoreKeyTextOutputFormat
                serde: org.apache.hadoop.hive.serde2.lazy.LazySimpleSerDe

  Stage: Stage-0
    Fetch Operator
      limit: -1


PREHOOK: query: explain select key, value from (select key, value from src9 group by key, value) t order by key desc, value
PREHOOK: type: QUERY
POSTHOOK: query: explain select key, value from (select key, value from src9 group by key, value) t order by key desc, value
POSTHOOK: type: QUERY
ABSTRACT SYNTAX TREE:
  (TOK_QUERY (TOK_FROM (TOK_SUBQUERY (TOK_QUERY (TOK_FROM (TOK_TABREF (TOK_TABNAME src9))) (TOK_INSERT (TOK_DESTINATION (TOK_DIR TOK_TMP_FILE)) (TOK_SELECT (TOK_SELEXPR (TOK_TABLE_OR_COL key)) (TOK_SELEXPR (TOK_TABLE_OR_COL value))) (TOK_GROUPBY (TOK_TABLE_OR_COL key) (TOK_TABLE_OR_COL value)))) t)) (TOK_INSERT (TOK_DESTINATION (TOK_DIR TOK_TMP_FILE)) (TOK_SELECT (TOK_SELEXPR (TOK_TABLE_OR_COL key)) (TOK_SELEXPR (TOK_TABLE_OR_COL value))) (TOK_ORDERBY (TOK_TABSORTCOLNAMEDESC (TOK_TABLE_OR_COL key)) (TOK_TABSORTCOLNAMEASC (TOK_TABLE_OR_COL value)))))

STAGE DEPENDENCIES:
  Stage-1 is a root stage
  Stage-0 is a root stage

STAGE PLANS:
  Stage: Stage-1
    Map Reduce
      Alias -> Map Operator Tree:
        t:src9 
          TableScan
            alias: src9
            Select Operator
              expressions:
                    expr: key
                    type: string
                    expr: value
                    type: string
              outputColumnNames: key, value
              Group By Operator
                bucketGroup: false
                keys:
                      expr: key
                      type: string
                      expr: value
                      type: string
                mode: hash
                outputColumnNames: _col0, _col1
                Reduce Output Operator
                  key expressions:
                        expr: _col0
                        type: string
                        expr: _col1
                        type: string
                  sort order: -+
                  Map-reduce partition columns:
                        expr: _col0
                        type: string
                        expr: _col1
                        type: string
                  tag: -1
      Reduce Operator Tree:
        Group By Operator
          bucketGroup: false
          keys:
                expr: KEY._col0
                type: string
                expr: KEY._col1
                type: string
          mode: mergepartial
          outputColumnNames: _col0, _col1
          Select Operator
            expressions:
                  expr: _col0
                  type: string
                  expr: _col1
                  type: string
            outputColumnNames: _col0, _col1
            File Output Operator
              compressed: false
              GlobalTableId: 0
              table:
                  input format: org.apache.hadoop.mapred.TextInputFormat
                  output format: org.apache.hadoop.hive.ql.io.HiveIgnoreKeyTextOutputFormat
                  serde: org.apache.hadoop.hive.serde2.lazy.LazySimpleSerDe

  Stage: Stage-0
    Fetch Operator
      limit: -1


PREHOOK: query: explain select key, value from (select key, value from src9 group by key, value) t order by value, key
PREHOOK: type: QUERY
POSTHOOK: query: explain select key, value from (select key, value from src9 group by key, value) t order by value, key
POSTHOOK: type: QUERY
ABSTRACT SYNTAX TREE:
  (TOK_QUERY (TOK_FROM (TOK_SUBQUERY (TOK_QUERY (TOK_FROM (TOK_TABREF (TOK_TABNAME src9))) (TOK_INSERT (TOK_DESTINATION (TOK_DIR TOK_TMP_FILE)) (TOK_SELECT (TOK_SELEXPR (TOK_TABLE_OR_COL key)) (TOK_SELEXPR (TOK_TABLE_OR_COL value))) (TOK_GROUPBY (TOK_TABLE_OR_COL key) (TOK_TABLE_OR_COL value)))) t)) (TOK_INSERT (TOK_DESTINATION (TOK_DIR TOK_TMP_FILE)) (TOK_SELECT (TOK_SELEXPR (TOK_TABLE_OR_COL key)) (TOK_SELEXPR (TOK_TABLE_OR_COL value))) (TOK_ORDERBY (TOK_TABSORTCOLNAMEASC (TOK_TABLE_OR_COL value)) (TOK_TABSORTCOLNAMEASC (TOK_TABLE_OR_COL key)))))

STAGE DEPENDENCIES:
  Stage-1 is a root stage
  Stage-0 is a root stage

STAGE PLANS:
  Stage: Stage-1
    Map Reduce
      Alias -> Map Operator Tree:
        t:src9 
          TableScan
            alias: src9
            Select Operator
              expressions:
                    expr: key
                    type: string
                    expr: value
                    type: string
              outputColumnNames: key, value
              Group By Operator
                bucketGroup: false
                keys:
                      expr: key
                      type: string
                      expr: value
                      type: string
                mode: hash
                outputColumnNames: _col0, _col1
                Reduce Output Operator
                  key expressions:
                        expr: _col1
                        type: string
                        expr: _col0
                        type: string
                  sort order: ++
                  Map-reduce partition columns:
                        expr: _col0
                        type: string
                        expr: _col1
                        type: string
                  tag: -1
      Reduce Operator Tree:
        Group By Operator
          bucketGroup: false
          keys:
                expr: KEY._col1
                type: string
                expr: KEY._col0
                type: string
          mode: mergepartial
          outputColumnNames: _col0, _col1
          Select Operator
            expressions:
                  expr: _col0
                  type: string
                  expr: _col1
                  type: string
            outputColumnNames: _col0, _col1
            File Output Operator
              compressed: false
              GlobalTableId: 0
              table:
                  input format: org.apache.hadoop.mapred.TextInputFormat
                  output format: org.apache.hadoop.hive.ql.io.HiveIgnoreKeyTextOutputFormat
                  serde: org.apache.hadoop.hive.serde2.lazy.LazySimpleSerDe

  Stage: Stage-0
    Fetch Operator
      limit: -1


PREHOOK: query: -- mGBY-RS-rGBY-mGBY-RS-rGBY
explain select k2, k4, count(k1), sum(k3) from (select k1, k2, k3, k4 from (select key k1, key k2, key k3, key k4 from src9) t group by k1, k2, k3, k4) t group by k2, k4
PREHOOK: type: QUERY
POSTHOOK: query: -- mGBY-RS-rGBY-mGBY-RS-rGBY
explain select k2, k4, count(k1), sum(k3) from (select k1, k2, k3, k4 from (select key k1, key k2, key k3, key k4 from src9) t group by k1, k2, k3, k4) t group by k2, k4
POSTHOOK: type: QUERY
ABSTRACT SYNTAX TREE:
  (TOK_QUERY (TOK_FROM (TOK_SUBQUERY (TOK_QUERY (TOK_FROM (TOK_SUBQUERY (TOK_QUERY (TOK_FROM (TOK_TABREF (TOK_TABNAME src9))) (TOK_INSERT (TOK_DESTINATION (TOK_DIR TOK_TMP_FILE)) (TOK_SELECT (TOK_SELEXPR (TOK_TABLE_OR_COL key) k1) (TOK_SELEXPR (TOK_TABLE_OR_COL key) k2) (TOK_SELEXPR (TOK_TABLE_OR_COL key) k3) (TOK_SELEXPR (TOK_TABLE_OR_COL key) k4)))) t)) (TOK_INSERT (TOK_DESTINATION (TOK_DIR TOK_TMP_FILE)) (TOK_SELECT (TOK_SELEXPR (TOK_TABLE_OR_COL k1)) (TOK_SELEXPR (TOK_TABLE_OR_COL k2)) (TOK_SELEXPR (TOK_TABLE_OR_COL k3)) (TOK_SELEXPR (TOK_TABLE_OR_COL k4))) (TOK_GROUPBY (TOK_TABLE_OR_COL k1) (TOK_TABLE_OR_COL k2) (TOK_TABLE_OR_COL k3) (TOK_TABLE_OR_COL k4)))) t)) (TOK_INSERT (TOK_DESTINATION (TOK_DIR TOK_TMP_FILE)) (TOK_SELECT (TOK_SELEXPR (TOK_TABLE_OR_COL k2)) (TOK_SELEXPR (TOK_TABLE_OR_COL k4)) (TOK_SELEXPR (TOK_FUNCTION count (TOK_TABLE_OR_COL k1))) (TOK_SELEXPR (TOK_FUNCTION sum (TOK_TABLE_OR_COL k3)))) (TOK_GROUPBY (TOK_TABLE_OR_COL k2) (TOK_TABLE_OR_COL k4))))

STAGE DEPENDENCIES:
  Stage-1 is a root stage
  Stage-0 is a root stage

STAGE PLANS:
  Stage: Stage-1
    Map Reduce
      Alias -> Map Operator Tree:
        t:t:src9 
          TableScan
            alias: src9
            Select Operator
              expressions:
                    expr: key
                    type: string
                    expr: key
                    type: string
                    expr: key
                    type: string
                    expr: key
                    type: string
              outputColumnNames: _col0, _col1, _col2, _col3
              Group By Operator
                bucketGroup: false
                keys:
                      expr: _col0
                      type: string
                      expr: _col1
                      type: string
                      expr: _col2
                      type: string
                      expr: _col3
                      type: string
                mode: hash
                outputColumnNames: _col0, _col1, _col2, _col3
                Reduce Output Operator
                  key expressions:
                        expr: _col1
                        type: string
                        expr: _col3
                        type: string
                  sort order: ++
                  Map-reduce partition columns:
                        expr: _col1
                        type: string
                        expr: _col3
                        type: string
                  tag: -1
                  value expressions:
                        expr: _col0
                        type: string
                        expr: _col2
                        type: string
      Reduce Operator Tree:
        Group By Operator
          bucketGroup: false
          keys:
                expr: VALUE._col0
                type: string
                expr: KEY._col0
                type: string
                expr: VALUE._col1
                type: string
                expr: KEY._col1
                type: string
          mode: mergepartial
          outputColumnNames: _col0, _col1, _col2, _col3
          Select Operator
            expressions:
                  expr: _col0
                  type: string
                  expr: _col1
                  type: string
                  expr: _col2
                  type: string
                  expr: _col3
                  type: string
            outputColumnNames: _col0, _col1, _col2, _col3
            Group By Operator
              aggregations:
                    expr: count(_col0)
                    expr: sum(_col2)
              bucketGroup: false
              keys:
                    expr: _col1
                    type: string
                    expr: _col3
                    type: string
              mode: complete
              outputColumnNames: _col0, _col1, _col2, _col3
              Select Operator
                expressions:
                      expr: _col0
                      type: string
                      expr: _col1
                      type: string
                      expr: _col2
                      type: bigint
                      expr: _col3
                      type: double
                outputColumnNames: _col0, _col1, _col2, _col3
                File Output Operator
                  compressed: false
                  GlobalTableId: 0
                  table:
                      input format: org.apache.hadoop.mapred.TextInputFormat
                      output format: org.apache.hadoop.hive.ql.io.HiveIgnoreKeyTextOutputFormat
                      serde: org.apache.hadoop.hive.serde2.lazy.LazySimpleSerDe

  Stage: Stage-0
    Fetch Operator
      limit: -1


PREHOOK: query: select key, value from (select key, value from src9 order by key, value) t group by value, key
PREHOOK: type: QUERY
PREHOOK: Input: default@src9
#### A masked pattern was here ####
POSTHOOK: query: select key, value from (select key, value from src9 order by key, value) t group by value, key
POSTHOOK: type: QUERY
POSTHOOK: Input: default@src9
#### A masked pattern was here ####
128	val_128
150	val_150
165	val_165
193	val_193
213	val_213
213	val_214
200	val_215
224	val_224
238	val_238
238	val_239
238	val_240
255	val_255
265	val_265
27	val_27
273	val_273
278	val_278
311	val_311
369	val_369
401	val_401
409	val_409
484	val_484
66	val_66
86	val_86
98	val_98
PREHOOK: query: select key, sum(key) as value from src9 group by key order by value, key
PREHOOK: type: QUERY
PREHOOK: Input: default@src9
#### A masked pattern was here ####
POSTHOOK: query: select key, sum(key) as value from src9 group by key order by value, key
POSTHOOK: type: QUERY
POSTHOOK: Input: default@src9
#### A masked pattern was here ####
27	27.0
66	66.0
86	86.0
98	98.0
128	128.0
150	150.0
165	165.0
193	193.0
200	200.0
224	224.0
255	255.0
265	265.0
273	273.0
278	278.0
311	311.0
369	369.0
401	401.0
409	409.0
484	484.0
213	639.0
238	714.0
PREHOOK: query: select key, value from (select key, value from src9 group by key, value) t order by key desc, value
PREHOOK: type: QUERY
PREHOOK: Input: default@src9
#### A masked pattern was here ####
POSTHOOK: query: select key, value from (select key, value from src9 group by key, value) t order by key desc, value
POSTHOOK: type: QUERY
POSTHOOK: Input: default@src9
#### A masked pattern was here ####
98	val_98
86	val_86
66	val_66
484	val_484
409	val_409
401	val_401
369	val_369
311	val_311
278	val_278
273	val_273
27	val_27
265	val_265
255	val_255
238	val_238
238	val_239
238	val_240
224	val_224
213	val_213
213	val_214
200	val_215
193	val_193
165	val_165
150	val_150
128	val_128
PREHOOK: query: select key, value from (select key, value from src9 group by key, value) t order by value, key
PREHOOK: type: QUERY
PREHOOK: Input: default@src9
#### A masked pattern was here ####
POSTHOOK: query: select key, value from (select key, value from src9 group by key, value) t order by value, key
POSTHOOK: type: QUERY
POSTHOOK: Input: default@src9
#### A masked pattern was here ####
128	val_128
150	val_150
165	val_165
193	val_193
213	val_213
213	val_214
200	val_215
224	val_224
238	val_238
238	val_239
238	val_240
255	val_255
265	val_265
27	val_27
273	val_273
278	val_278
311	val_311
369	val_369
401	val_401
409	val_409
484	val_484
66	val_66
86	val_86
98	val_98
PREHOOK: query: select k2, k4, count(k1), sum(k3) from (select k1, k2, k3, k4 from (select key k1, key k2, key k3, key k4 from src9) t group by k1, k2, k3, k4) t group by k2, k4
PREHOOK: type: QUERY
PREHOOK: Input: default@src9
#### A masked pattern was here ####
POSTHOOK: query: select k2, k4, count(k1), sum(k3) from (select k1, k2, k3, k4 from (select key k1, key k2, key k3, key k4 from src9) t group by k1, k2, k3, k4) t group by k2, k4
POSTHOOK: type: QUERY
POSTHOOK: Input: default@src9
#### A masked pattern was here ####
128	128	1	128.0
150	150	1	150.0
165	165	1	165.0
193	193	1	193.0
200	200	1	200.0
213	213	1	213.0
224	224	1	224.0
238	238	1	238.0
255	255	1	255.0
265	265	1	265.0
27	27	1	27.0
273	273	1	273.0
278	278	1	278.0
311	311	1	311.0
369	369	1	369.0
401	401	1	401.0
409	409	1	409.0
484	484	1	484.0
66	66	1	66.0
86	86	1	86.0
98	98	1	98.0
PREHOOK: query: -- RS-RS-GBY
explain select key, value from (select key, value from src9 order by key, value) t group by value, key
PREHOOK: type: QUERY
POSTHOOK: query: -- RS-RS-GBY
explain select key, value from (select key, value from src9 order by key, value) t group by value, key
POSTHOOK: type: QUERY
ABSTRACT SYNTAX TREE:
  (TOK_QUERY (TOK_FROM (TOK_SUBQUERY (TOK_QUERY (TOK_FROM (TOK_TABREF (TOK_TABNAME src9))) (TOK_INSERT (TOK_DESTINATION (TOK_DIR TOK_TMP_FILE)) (TOK_SELECT (TOK_SELEXPR (TOK_TABLE_OR_COL key)) (TOK_SELEXPR (TOK_TABLE_OR_COL value))) (TOK_ORDERBY (TOK_TABSORTCOLNAMEASC (TOK_TABLE_OR_COL key)) (TOK_TABSORTCOLNAMEASC (TOK_TABLE_OR_COL value))))) t)) (TOK_INSERT (TOK_DESTINATION (TOK_DIR TOK_TMP_FILE)) (TOK_SELECT (TOK_SELEXPR (TOK_TABLE_OR_COL key)) (TOK_SELEXPR (TOK_TABLE_OR_COL value))) (TOK_GROUPBY (TOK_TABLE_OR_COL value) (TOK_TABLE_OR_COL key))))

STAGE DEPENDENCIES:
  Stage-1 is a root stage
  Stage-0 is a root stage

STAGE PLANS:
  Stage: Stage-1
    Map Reduce
      Alias -> Map Operator Tree:
        t:src9 
          TableScan
            alias: src9
            Select Operator
              expressions:
                    expr: key
                    type: string
                    expr: value
                    type: string
              outputColumnNames: _col0, _col1
              Reduce Output Operator
                key expressions:
                      expr: _col1
                      type: string
                      expr: _col0
                      type: string
                sort order: ++
                tag: -1
                value expressions:
                      expr: _col0
                      type: string
                      expr: _col1
                      type: string
      Reduce Operator Tree:
        Extract
          Select Operator
            expressions:
                  expr: _col0
                  type: string
                  expr: _col1
                  type: string
            outputColumnNames: _col0, _col1
            Group By Operator
              bucketGroup: false
              keys:
                    expr: _col1
                    type: string
                    expr: _col0
                    type: string
              mode: complete
              outputColumnNames: _col0, _col1
              Select Operator
                expressions:
                      expr: _col1
                      type: string
                      expr: _col0
                      type: string
                outputColumnNames: _col0, _col1
                File Output Operator
                  compressed: false
                  GlobalTableId: 0
                  table:
                      input format: org.apache.hadoop.mapred.TextInputFormat
                      output format: org.apache.hadoop.hive.ql.io.HiveIgnoreKeyTextOutputFormat
                      serde: org.apache.hadoop.hive.serde2.lazy.LazySimpleSerDe

  Stage: Stage-0
    Fetch Operator
      limit: -1


PREHOOK: query: -- RS-GBY-RS
-- should not be optimized
explain select key, sum(key) as value from src9 group by key order by value, key
PREHOOK: type: QUERY
POSTHOOK: query: -- RS-GBY-RS
-- should not be optimized
explain select key, sum(key) as value from src9 group by key order by value, key
POSTHOOK: type: QUERY
ABSTRACT SYNTAX TREE:
  (TOK_QUERY (TOK_FROM (TOK_TABREF (TOK_TABNAME src9))) (TOK_INSERT (TOK_DESTINATION (TOK_DIR TOK_TMP_FILE)) (TOK_SELECT (TOK_SELEXPR (TOK_TABLE_OR_COL key)) (TOK_SELEXPR (TOK_FUNCTION sum (TOK_TABLE_OR_COL key)) value)) (TOK_GROUPBY (TOK_TABLE_OR_COL key)) (TOK_ORDERBY (TOK_TABSORTCOLNAMEASC (TOK_TABLE_OR_COL value)) (TOK_TABSORTCOLNAMEASC (TOK_TABLE_OR_COL key)))))

STAGE DEPENDENCIES:
  Stage-1 is a root stage
  Stage-2 depends on stages: Stage-1
  Stage-0 is a root stage

STAGE PLANS:
  Stage: Stage-1
    Map Reduce
      Alias -> Map Operator Tree:
        src9 
          TableScan
            alias: src9
            Select Operator
              expressions:
                    expr: key
                    type: string
              outputColumnNames: key
              Reduce Output Operator
                key expressions:
                      expr: key
                      type: string
                sort order: +
                Map-reduce partition columns:
                      expr: key
                      type: string
                tag: -1
      Reduce Operator Tree:
        Group By Operator
          aggregations:
                expr: sum(KEY._col0)
          bucketGroup: false
          keys:
                expr: KEY._col0
                type: string
          mode: complete
          outputColumnNames: _col0, _col1
          Select Operator
            expressions:
                  expr: _col0
                  type: string
                  expr: _col1
                  type: double
            outputColumnNames: _col0, _col1
            File Output Operator
              compressed: false
              GlobalTableId: 0
              table:
                  input format: org.apache.hadoop.mapred.SequenceFileInputFormat
                  output format: org.apache.hadoop.hive.ql.io.HiveSequenceFileOutputFormat
                  serde: org.apache.hadoop.hive.serde2.lazybinary.LazyBinarySerDe

  Stage: Stage-2
    Map Reduce
      Alias -> Map Operator Tree:
#### A masked pattern was here ####
          TableScan
            Reduce Output Operator
              key expressions:
                    expr: _col1
                    type: double
                    expr: _col0
                    type: string
              sort order: ++
              tag: -1
              value expressions:
                    expr: _col0
                    type: string
                    expr: _col1
                    type: double
      Reduce Operator Tree:
        Extract
          File Output Operator
            compressed: false
            GlobalTableId: 0
            table:
                input format: org.apache.hadoop.mapred.TextInputFormat
                output format: org.apache.hadoop.hive.ql.io.HiveIgnoreKeyTextOutputFormat
                serde: org.apache.hadoop.hive.serde2.lazy.LazySimpleSerDe

  Stage: Stage-0
    Fetch Operator
      limit: -1


PREHOOK: query: explain select key, value from (select key, value from src9 group by key, value) t order by key desc, value
PREHOOK: type: QUERY
POSTHOOK: query: explain select key, value from (select key, value from src9 group by key, value) t order by key desc, value
POSTHOOK: type: QUERY
ABSTRACT SYNTAX TREE:
  (TOK_QUERY (TOK_FROM (TOK_SUBQUERY (TOK_QUERY (TOK_FROM (TOK_TABREF (TOK_TABNAME src9))) (TOK_INSERT (TOK_DESTINATION (TOK_DIR TOK_TMP_FILE)) (TOK_SELECT (TOK_SELEXPR (TOK_TABLE_OR_COL key)) (TOK_SELEXPR (TOK_TABLE_OR_COL value))) (TOK_GROUPBY (TOK_TABLE_OR_COL key) (TOK_TABLE_OR_COL value)))) t)) (TOK_INSERT (TOK_DESTINATION (TOK_DIR TOK_TMP_FILE)) (TOK_SELECT (TOK_SELEXPR (TOK_TABLE_OR_COL key)) (TOK_SELEXPR (TOK_TABLE_OR_COL value))) (TOK_ORDERBY (TOK_TABSORTCOLNAMEDESC (TOK_TABLE_OR_COL key)) (TOK_TABSORTCOLNAMEASC (TOK_TABLE_OR_COL value)))))

STAGE DEPENDENCIES:
  Stage-1 is a root stage
  Stage-0 is a root stage

STAGE PLANS:
  Stage: Stage-1
    Map Reduce
      Alias -> Map Operator Tree:
        t:src9 
          TableScan
            alias: src9
            Select Operator
              expressions:
                    expr: key
                    type: string
                    expr: value
                    type: string
              outputColumnNames: key, value
              Reduce Output Operator
                key expressions:
                      expr: key
                      type: string
                      expr: value
                      type: string
                sort order: -+
                Map-reduce partition columns:
                      expr: key
                      type: string
                      expr: value
                      type: string
                tag: -1
      Reduce Operator Tree:
        Group By Operator
          bucketGroup: false
          keys:
                expr: KEY._col0
                type: string
                expr: KEY._col1
                type: string
          mode: complete
          outputColumnNames: _col0, _col1
          Select Operator
            expressions:
                  expr: _col0
                  type: string
                  expr: _col1
                  type: string
            outputColumnNames: _col0, _col1
            File Output Operator
              compressed: false
              GlobalTableId: 0
              table:
                  input format: org.apache.hadoop.mapred.TextInputFormat
                  output format: org.apache.hadoop.hive.ql.io.HiveIgnoreKeyTextOutputFormat
                  serde: org.apache.hadoop.hive.serde2.lazy.LazySimpleSerDe

  Stage: Stage-0
    Fetch Operator
      limit: -1


PREHOOK: query: explain select key, value from (select key, value from src9 group by key, value) t order by value, key
PREHOOK: type: QUERY
POSTHOOK: query: explain select key, value from (select key, value from src9 group by key, value) t order by value, key
POSTHOOK: type: QUERY
ABSTRACT SYNTAX TREE:
  (TOK_QUERY (TOK_FROM (TOK_SUBQUERY (TOK_QUERY (TOK_FROM (TOK_TABREF (TOK_TABNAME src9))) (TOK_INSERT (TOK_DESTINATION (TOK_DIR TOK_TMP_FILE)) (TOK_SELECT (TOK_SELEXPR (TOK_TABLE_OR_COL key)) (TOK_SELEXPR (TOK_TABLE_OR_COL value))) (TOK_GROUPBY (TOK_TABLE_OR_COL key) (TOK_TABLE_OR_COL value)))) t)) (TOK_INSERT (TOK_DESTINATION (TOK_DIR TOK_TMP_FILE)) (TOK_SELECT (TOK_SELEXPR (TOK_TABLE_OR_COL key)) (TOK_SELEXPR (TOK_TABLE_OR_COL value))) (TOK_ORDERBY (TOK_TABSORTCOLNAMEASC (TOK_TABLE_OR_COL value)) (TOK_TABSORTCOLNAMEASC (TOK_TABLE_OR_COL key)))))

STAGE DEPENDENCIES:
  Stage-1 is a root stage
  Stage-0 is a root stage

STAGE PLANS:
  Stage: Stage-1
    Map Reduce
      Alias -> Map Operator Tree:
        t:src9 
          TableScan
            alias: src9
            Select Operator
              expressions:
                    expr: key
                    type: string
                    expr: value
                    type: string
              outputColumnNames: key, value
              Reduce Output Operator
                key expressions:
                      expr: value
                      type: string
                      expr: key
                      type: string
                sort order: ++
                Map-reduce partition columns:
                      expr: key
                      type: string
                      expr: value
                      type: string
                tag: -1
      Reduce Operator Tree:
        Group By Operator
          bucketGroup: false
          keys:
                expr: KEY._col1
                type: string
                expr: KEY._col0
                type: string
          mode: complete
          outputColumnNames: _col0, _col1
          Select Operator
            expressions:
                  expr: _col0
                  type: string
                  expr: _col1
                  type: string
            outputColumnNames: _col0, _col1
            File Output Operator
              compressed: false
              GlobalTableId: 0
              table:
                  input format: org.apache.hadoop.mapred.TextInputFormat
                  output format: org.apache.hadoop.hive.ql.io.HiveIgnoreKeyTextOutputFormat
                  serde: org.apache.hadoop.hive.serde2.lazy.LazySimpleSerDe

  Stage: Stage-0
    Fetch Operator
      limit: -1


PREHOOK: query: -- RS-GBY-RS-GBY
explain select k2, k4, count(k1), sum(k3) from (select k1, k2, k3, k4 from (select key k1, key k2, key k3, key k4 from src9) t group by k1, k2, k3, k4) t group by k2, k4
PREHOOK: type: QUERY
POSTHOOK: query: -- RS-GBY-RS-GBY
explain select k2, k4, count(k1), sum(k3) from (select k1, k2, k3, k4 from (select key k1, key k2, key k3, key k4 from src9) t group by k1, k2, k3, k4) t group by k2, k4
POSTHOOK: type: QUERY
ABSTRACT SYNTAX TREE:
  (TOK_QUERY (TOK_FROM (TOK_SUBQUERY (TOK_QUERY (TOK_FROM (TOK_SUBQUERY (TOK_QUERY (TOK_FROM (TOK_TABREF (TOK_TABNAME src9))) (TOK_INSERT (TOK_DESTINATION (TOK_DIR TOK_TMP_FILE)) (TOK_SELECT (TOK_SELEXPR (TOK_TABLE_OR_COL key) k1) (TOK_SELEXPR (TOK_TABLE_OR_COL key) k2) (TOK_SELEXPR (TOK_TABLE_OR_COL key) k3) (TOK_SELEXPR (TOK_TABLE_OR_COL key) k4)))) t)) (TOK_INSERT (TOK_DESTINATION (TOK_DIR TOK_TMP_FILE)) (TOK_SELECT (TOK_SELEXPR (TOK_TABLE_OR_COL k1)) (TOK_SELEXPR (TOK_TABLE_OR_COL k2)) (TOK_SELEXPR (TOK_TABLE_OR_COL k3)) (TOK_SELEXPR (TOK_TABLE_OR_COL k4))) (TOK_GROUPBY (TOK_TABLE_OR_COL k1) (TOK_TABLE_OR_COL k2) (TOK_TABLE_OR_COL k3) (TOK_TABLE_OR_COL k4)))) t)) (TOK_INSERT (TOK_DESTINATION (TOK_DIR TOK_TMP_FILE)) (TOK_SELECT (TOK_SELEXPR (TOK_TABLE_OR_COL k2)) (TOK_SELEXPR (TOK_TABLE_OR_COL k4)) (TOK_SELEXPR (TOK_FUNCTION count (TOK_TABLE_OR_COL k1))) (TOK_SELEXPR (TOK_FUNCTION sum (TOK_TABLE_OR_COL k3)))) (TOK_GROUPBY (TOK_TABLE_OR_COL k2) (TOK_TABLE_OR_COL k4))))

STAGE DEPENDENCIES:
  Stage-1 is a root stage
  Stage-0 is a root stage

STAGE PLANS:
  Stage: Stage-1
    Map Reduce
      Alias -> Map Operator Tree:
        t:t:src9 
          TableScan
            alias: src9
            Select Operator
              expressions:
                    expr: key
                    type: string
                    expr: key
                    type: string
                    expr: key
                    type: string
                    expr: key
                    type: string
              outputColumnNames: _col0, _col1, _col2, _col3
              Reduce Output Operator
                key expressions:
                      expr: _col1
                      type: string
                      expr: _col3
                      type: string
                sort order: ++
                Map-reduce partition columns:
                      expr: _col1
                      type: string
                      expr: _col3
                      type: string
                tag: -1
                value expressions:
                      expr: _col0
                      type: string
                      expr: _col2
                      type: string
      Reduce Operator Tree:
        Group By Operator
          bucketGroup: false
          keys:
                expr: VALUE._col0
                type: string
                expr: KEY._col0
                type: string
                expr: VALUE._col1
                type: string
                expr: KEY._col1
                type: string
          mode: complete
          outputColumnNames: _col0, _col1, _col2, _col3
          Select Operator
            expressions:
                  expr: _col0
                  type: string
                  expr: _col1
                  type: string
                  expr: _col2
                  type: string
                  expr: _col3
                  type: string
            outputColumnNames: _col0, _col1, _col2, _col3
            Group By Operator
              aggregations:
                    expr: count(_col0)
                    expr: sum(_col2)
              bucketGroup: false
              keys:
                    expr: _col1
                    type: string
                    expr: _col3
                    type: string
              mode: complete
              outputColumnNames: _col0, _col1, _col2, _col3
              Select Operator
                expressions:
                      expr: _col0
                      type: string
                      expr: _col1
                      type: string
                      expr: _col2
                      type: bigint
                      expr: _col3
                      type: double
                outputColumnNames: _col0, _col1, _col2, _col3
                File Output Operator
                  compressed: false
                  GlobalTableId: 0
                  table:
                      input format: org.apache.hadoop.mapred.TextInputFormat
                      output format: org.apache.hadoop.hive.ql.io.HiveIgnoreKeyTextOutputFormat
                      serde: org.apache.hadoop.hive.serde2.lazy.LazySimpleSerDe

  Stage: Stage-0
    Fetch Operator
      limit: -1


PREHOOK: query: select key, value from (select key, value from src9 order by key, value) t group by value, key
PREHOOK: type: QUERY
PREHOOK: Input: default@src9
#### A masked pattern was here ####
POSTHOOK: query: select key, value from (select key, value from src9 order by key, value) t group by value, key
POSTHOOK: type: QUERY
POSTHOOK: Input: default@src9
#### A masked pattern was here ####
128	val_128
150	val_150
165	val_165
193	val_193
213	val_213
213	val_214
200	val_215
224	val_224
238	val_238
238	val_239
238	val_240
255	val_255
265	val_265
27	val_27
273	val_273
278	val_278
311	val_311
369	val_369
401	val_401
409	val_409
484	val_484
66	val_66
86	val_86
98	val_98
PREHOOK: query: select key, sum(key) as value from src9 group by key order by value, key
PREHOOK: type: QUERY
PREHOOK: Input: default@src9
#### A masked pattern was here ####
POSTHOOK: query: select key, sum(key) as value from src9 group by key order by value, key
POSTHOOK: type: QUERY
POSTHOOK: Input: default@src9
#### A masked pattern was here ####
27	27.0
66	66.0
86	86.0
98	98.0
128	128.0
150	150.0
165	165.0
193	193.0
200	200.0
224	224.0
255	255.0
265	265.0
273	273.0
278	278.0
311	311.0
369	369.0
401	401.0
409	409.0
484	484.0
213	639.0
238	714.0
PREHOOK: query: select key, value from (select key, value from src9 group by key, value) t order by key desc, value
PREHOOK: type: QUERY
PREHOOK: Input: default@src9
#### A masked pattern was here ####
POSTHOOK: query: select key, value from (select key, value from src9 group by key, value) t order by key desc, value
POSTHOOK: type: QUERY
POSTHOOK: Input: default@src9
#### A masked pattern was here ####
98	val_98
86	val_86
66	val_66
484	val_484
409	val_409
401	val_401
369	val_369
311	val_311
278	val_278
273	val_273
27	val_27
265	val_265
255	val_255
238	val_238
238	val_239
238	val_240
224	val_224
213	val_213
213	val_214
200	val_215
193	val_193
165	val_165
150	val_150
128	val_128
PREHOOK: query: select key, value from (select key, value from src9 group by key, value) t order by value, key
PREHOOK: type: QUERY
PREHOOK: Input: default@src9
#### A masked pattern was here ####
POSTHOOK: query: select key, value from (select key, value from src9 group by key, value) t order by value, key
POSTHOOK: type: QUERY
POSTHOOK: Input: default@src9
#### A masked pattern was here ####
128	val_128
150	val_150
165	val_165
193	val_193
213	val_213
213	val_214
200	val_215
224	val_224
238	val_238
238	val_239
238	val_240
255	val_255
265	val_265
27	val_27
273	val_273
278	val_278
311	val_311
369	val_369
401	val_401
409	val_409
484	val_484
66	val_66
86	val_86
98	val_98
PREHOOK: query: select k2, k4, count(k1), sum(k3) from (select k1, k2, k3, k4 from (select key k1, key k2, key k3, key k4 from src9) t group by k1, k2, k3, k4) t group by k2, k4
PREHOOK: type: QUERY
PREHOOK: Input: default@src9
#### A masked pattern was here ####
POSTHOOK: query: select k2, k4, count(k1), sum(k3) from (select k1, k2, k3, k4 from (select key k1, key k2, key k3, key k4 from src9) t group by k1, k2, k3, k4) t group by k2, k4
POSTHOOK: type: QUERY
POSTHOOK: Input: default@src9
#### A masked pattern was here ####
128	128	1	128.0
150	150	1	150.0
165	165	1	165.0
193	193	1	193.0
200	200	1	200.0
213	213	1	213.0
224	224	1	224.0
238	238	1	238.0
255	255	1	255.0
265	265	1	265.0
27	27	1	27.0
273	273	1	273.0
278	278	1	278.0
311	311	1	311.0
369	369	1	369.0
401	401	1	401.0
409	409	1	409.0
484	484	1	484.0
66	66	1	66.0
86	86	1	86.0
98	98	1	98.0
PREHOOK: query: drop table src9
PREHOOK: type: DROPTABLE
PREHOOK: Input: default@src9
PREHOOK: Output: default@src9
POSTHOOK: query: drop table src9
POSTHOOK: type: DROPTABLE
POSTHOOK: Input: default@src9
POSTHOOK: Output: default@src9
